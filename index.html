<!DOCTYPE html>
<!--
    CoilChoice: A tool for understanding and desiging electromagnetic coils for MMF
    Copyright (C) 2015  Robert L. Read

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Coil Choice</title>
    <meta name="description" content="A Model of Electromagnetic Coils" />
    <meta name="keywords" content="d3.js, area charts, zoom, pan,
				   data, infographic, ajavscript, chart, coil, magneto-motive force,
				   MMF, AWG" />
    <link rel="shortcut icon" href="../favicon.ico"> 
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript" src="vis/dist/vis.js"></script>
    <script src="CoilModel.js"></script>
   <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.5-dist//css/bootstrap.min.css" rel="stylesheet">

 
<script type="text/javascript">

var amperage_graph = null;
var coilheat_graph = null;
var amperage_models = [];
var coilheat_models = [];

var amperage_data = null;
var coilheat_data = null;

function basic_options() {
    this.width=  '600px';
    this.height= '600px';
    this.style= 'bar-color';
    this.showPerspective= true;
    this.showGrid= true;
    this.showShadow= true;

   this.tooltip= function (point) {
     var m = find_in_models(amperage_models,point.x,point.y,point.z);
     return renderAsHTML(m.model);
   };
   this.xLabel= "AWG";
   this.yLabel= "Coil Width";
   this.zLabel= "Effective MMF";
   this.xValueLabel= function(value) {
     return AWG_indexes[value];
   };
       
   this.yValueLabel= function(value) {
     return value + 'mm';
   };

   this.zValueLabel= function(value) {
     return value +' Ampere-Turns';
   };
   this.filterLabel= 'Maximum Ampere Limit: ';

    this.keepAspectRatio= true;
    this.verticalRatio= 0.5;
    this.animationInterval= 1000; // milliseconds
    this.animationPreload= true;
    // This may be annoying, but alerts the use to the fact 
    // that it is an interactive model.
    this.animationAutoStart= true;
    this.showAnimationControls= true
  };

  var amperage_options = new basic_options();

  amperage_options.tooltip =  function (point) {
     var m = find_in_models(amperage_models,point.x,point.y,point.z);
     return renderAsHTML(m.model);
   };
   amperage_options.zLabel = "Effective MMF",

   amperage_options.zValueLabel = function(value) {
     return value +' Ampere-Turns';
   };
   amperage_options.filterLabel = 'Maximum Ampere Limit: ';

  var coilheat_options = new basic_options();

  coilheat_options.tooltip = function (point) {
     var m = find_in_models(coilheat_models,point.x,point.y,point.z);
     return renderAsHTML(m.model);
   },
   coilheat_options.zLabel = "Effective MMF",

   coilheat_options.zValueLabel = function(value) {
     return value +' Watts';
   },
   coilheat_options.filterLabel = 'Maximum Coil Wattage: ',

function find_in_models(ms,x,y,z) {
   var result = null;
   var q = [];
   for(var i = 0; i < ms.length; i++) {
      var d = ms[i];
      if ((d.x == x) && (d.y == y) && (d.z == z)) {
         result = d;
      }

   }
   return result;
}


function constructModel() {

  amperage_data = new vis.DataSet();
  coilheat_data = new vis.DataSet();

  amperage_models = [];
  coilheart_models = [];

  var xsteps = 4;  // number of datapoints will be steps*steps
  var ysteps = 10;  // number of datapoints will be steps*steps
  var xaxisMax = 7;
  var xaxisStep = 1;
  var yaxisMax = 10;
  var yaxisStep = yaxisMax / ysteps;

// This charting system takes x and y to be the physical
// spatial dimensions, we we have to map these into things that 
// make sense in our model, since we have vastly different scales...
// Effectively we need a model transducer....

// Our basic model is to vary x as wire guage, and y as bobbin diameter.
// t is a the animation parameter
  var tMax = 50;

  var internal_resistance = parseFloat($("#internalresistance").val()); 
  var bobbin_inner_diameter = parseFloat($("#bobbininnerdiameter").val()); 
  var bobbin_length = parseFloat($("#bobbinlength").val()); 
  var voltage = parseFloat($("#voltage").val()); 
  var magnetdiameter = parseFloat($("#magnetdiameter").val()); 


  for (var t = 0; t < tMax; t++) {
    for (var x = 0; x <= xaxisMax; x+=xaxisStep) {
      for (var y = 1; y <= yaxisMax; y+=yaxisStep) { 

// Now set up the model object....
        var awg = AWG_indexes[x]; // AWG
	var model = new CoilModel;
        model.Voltage = voltage;
        model.InternalResistance = internal_resistance;

	model.MagnetDiameter = magnetdiameter;
        model.BobbinOuterDiameter = model.BobbinInnerDiameter + y*1.0;
        model.AWG = awg;
        var computed = computeFromModel(model);
        var amp_limit = t * 2.0;
	var heat_limit = t * 40;
	var amp_value = (computed.Amperage > amp_limit) ? -1.0 : computed.EffectiveMMF  ;
	amperage_data.add({x: x, y: y, z: amp_value, filter: t,
	    style: amp_value, model: computed});

	amperage_models.push({x:x, y:y, z: amp_value, filter: t,
	    model: computed});

	var heat_value = (computed.CoilHeat > heat_limit) ? -1.0 : computed.CoilHeat  ;
	coilheat_data.add({x: x, y: y, z: heat_value, filter: t,
	    style: heat_value, model: computed});

	coilheat_models.push({x:x, y:y, z: heat_value, filter: t,
	    model: computed});
      }
    }
  }
}


// Called when the Visualization API is loaded.
function drawAmperageVisualization() {
  constructModel();

  var style = document.getElementById('style').value;
  var withValue = ['bar-color', 'bar-size', 'dot-size', 'dot-color'].indexOf(style) != -1;

// specify options

  var camera = amperage_graph ? amperage_graph.getCameraPosition() : null;

// create our graphs
  var container = document.getElementById('amperagelimitchart');
  amperage_graph = new vis.Graph3d(container, amperage_data, amperage_options);

  if (camera) amperage_graph.setCameraPosition(camera); // restore camera position

  document.getElementById('style').onchange = drawVisualization;

}

// Called when the Visualization API is loaded.
function drawCoilHeatVisualization() {
  constructModel();


  var style = document.getElementById('style').value;
  var withValue = ['bar-color', 'bar-size', 'dot-size', 'dot-color'].indexOf(style) != -1;


  var camera = coilheat_graph ? coilheat_graph.getCameraPosition() : null;

// create our graphs

  var container = document.getElementById('coilheatlimitchart');
  coilheat_graph = new vis.Graph3d(container, coilheat_data, coilheat_options);

  if (camera) coilheat_graph.setCameraPosition(camera); // restore camera position

  document.getElementById('style').onchange = drawVisualization;

}

function drawVisualization()
{
 drawAmperageVisualization();
 drawCoilHeatVisualization();
}
</script>

    <style>
    </style>
  </head>

  <body onload="drawVisualization()">
  <div class="container">

      <div class="page-header">
        <h1>Coil Choice: A model of electromagnetic coils</h1>
        <p class="lead">Adjust, fiddle and understand.</p>
      </div>

      <div class="row">
        <div class="col-md-12">
    <span id="controls">
    <p>
      <label for="style"> Style:
	<select id="style">
	  <option value="bar-color">bar-color</option>
	  <option value="surface">surface</option>
	  <option value="dot-color">dot-color</option>
	  <option value="dot-size">dot-size</option>
	</select>
      </label>
    </p>
    <p>
      <table>
	<tr>
          <td>Voltage (V)</td>
	  <td><input type="text" id="voltage" value="12"></td>
	</tr>
	<tr>
          <td>Internal Resistance (Ohms) </td>
	  <td><input type="text" id="internalresistance" value="0.025"></td>
	</tr>
	<tr>
	  <td>Magnet Diameter (mm)</td>
	  <td><input type="text" id="magnetdiameter" value="6.35"></td>
	</tr>
	<tr>
	  <td>BobbinInnerDiameter (mm)</td>
	  <td><input type="text" id="bobbininnerdiameter" value="12"></td>
	</tr>
	<tr>
	  <td>BobbinLength (mm)</td>
	  <td><input type="text" id="bobbinlength" value="12"></td>
	</tr>
	<tr>
	  <td></td>
	  <td><input type="button" value="Set" 
		     onclick="drawVisualization();"></td>
	</tr>
      </table>
    </p>
</span>
	</div>
        <div class="col-md-6"><span id="coilheatlimitchart">
</div>
        <div class="col-md-6"> <span id="amperagelimitchart"></span></div>
      </div>
</div>

      <div id="modelinfo">
	<h2>A Basic Physical and Electrical Model</h2>
	<p>
	  Laws and assumptions
	</p>
	<p>
	  Ohm's laws		V = IR
	</p>
	<p>
	  MMF		F = NI
	</p>
	<p>						
	  I assume wire packs as if it were efficiently packed in a squares containing the outer diamter of the wire.						
	  I assume the effective force seen by a magnet of diameter is its
	  percentage of the total area of the coil.
	</p>
	<p>						
	  Windings 		W = Bobbin Length / Wire Diameter
	</p>
	<p>						  
	  Turns/ Winding		T = (OD - ID) / Wire Diameter				
	</p>
	<p>						  
	  Average Area of a turn		AA = (((OD - ID)/ 2) / 2)^2 * PI				
	</p>
	<p>						  
	  Example data:	CNC Tech 32 gauge manet wire		http://media.digikey.com/pdf/Data%20Sheets/CNC%20Tech%20PDFs/MW35C_Spec.pdf			
	  
	  32	0.0005434		0.0249	
	</p>
	<p>						  
	  Useful approximate battery resistances
	  http://www.learningaboutelectronics.com/Articles/Battery-internal-resistance
	</p>
      </div>


    <div id="thanks">
      <h2>Thanks</h2>
        <p>
      Thanks to Almende, B. V., for their open-source graphing software, <a href="http://visjs.org/">Vis.js</a>.
       </p>

       <p>
      Here is an informative reference with a table of typical internal restistances:
      <a href="http://www.learningaboutelectronics.com/Articles/Battery-internal-resistance">
http://www.learningaboutelectronics.com/Articles/Battery-internal-resistance
</a>
       </p>
    </div>


  </body>






</html>


