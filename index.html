<!DOCTYPE html>
<!--
    CoilChoice: A tool for understanding and desiging electromagnetic coils for MMF
    Copyright (C) 2015  Robert L. Read

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Coil Choice</title>
    <meta name="description" content="A Model of Electromagnetic Coils" />
    <meta name="keywords" content="d3.js, area charts, zoom, pan,
				   data, infographic, ajavscript, chart, coil, magneto-motive force,
				   MMF, AWG" />
    <link rel="shortcut icon" href="../favicon.ico"> 
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript" src="vis/dist/vis.js"></script>
    <script src="CoilModel.js"></script>
   <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.5-dist//css/bootstrap.min.css" rel="stylesheet">

 
<script type="text/javascript">

function basic_options() {
    this.width = '600px';
    this.height = '600px';
    this.style = 'bar-color';
    this.showPerspective = true;
    this.showGrid = true;
    this.showShadow = true;
    this.xLabel = "AWG";
    this.yLabel = "Coil Width";
    this.xValueLabel = function(value) {
        return AWG_indexes[value];
    };
    this.yValueLabel = function(value) {
        return value + 'mm';
    };
    this.keepAspectRatio = true;
    this.verticalRatio = 0.5;
    this.tooltip = function(point) {
      var m = find_in_models(models, point.x, point.y);
      return renderAsHTML(m.model);
    };
};

function amperage_options_obj() {
    basic_options.call(this);
    this.zLabel = "Amperage";
    this.zValueLabel = function(value) {
      return value + ' Amperes';
    };
    this.filterLabel = 'Maximum Ampere Limit: ';
    this.animationInterval = 1000; // milliseconds
    this.animationPreload = true;
    this.animationAutoStart = true;
    this.showAnimationControls = true
}
var amperage_options = new amperage_options_obj();

function coilheat_options_obj() {
    basic_options.call(this);
    this.zLabel = "Coil Heat",
    this.zValueLabel = function(value) {
        return value + ' Watts';
    };

    this.filterLabel = 'Maximum Coil Wattage: ';
    this.animationInterval = 1000; // milliseconds
    this.animationPreload = true;
    this.animationAutoStart = true;
    this.showAnimationControls = true
}

var coilheat_options = new coilheat_options_obj();

function mmf_options_obj() {
    basic_options.call(this);
    this.width = '900px';
    this.zLabel = "MMF";
    this.zValueLabel = function(value) {
      return value + ' Ampere-Turns';
    };
    this.animationAutoStart = false;
    this.showAnimationControls = false;
}
var mmf_options = new mmf_options_obj();

function mmf_value(t,computed) {
    return computed.MMF_amp_turns;
}
function amperage_value(t,computed) {
    var amp_limit = t * 2.0;
    return (computed.Amperage > amp_limit) ? -1.0 :
       computed.Amperage;
}
function coilheat_value(t,computed) {
   var heat_limit = t * 40;
   return (computed.CoilHeat > heat_limit) ? -1.0 :
                   computed.CoilHeat;
}

function visit_computed(f,computed,data,models,x,y,t) {
   var value = f(t,computed);
    data.add({
                    x: x,
                    y: y,
                    z: value,
                    filter: t,
                    style: value,
                    model: computed
                });
}

var all_graph_configs = [
{
  id: "mmfchart",
  graph: null,
  data: null,
  options: mmf_options,
  value: mmf_value
},
{
  id: "amperagelimitchart",
  graph: null,
  data: null,
  options: amperage_options,
  value: amperage_value
},
{
  id: "coilheatlimitchart",
  graph: null,
  data: null,
  options: coilheat_options,
  value: coilheat_value
}
];

var models = [];

// Note: This is really slow, but it doesn't seem to be a 
// problem yet...it can obviously be replaced with a better approach
function find_in_models(ms, x, y) {
    var result = null;
    var q = [];
    for (var i = 0; i < ms.length; i++) {
        var d = ms[i];
        if ((d.x == x) && (d.y == y)) {
            result = d;
        }
    }
    return result;
}


function constructModel() {
    all_graph_configs.forEach(function(c) {
		       c.data = new vis.DataSet(); 
		       } );

    var xsteps = 4; // number of datapoints will be steps*steps
    var ysteps = 10; // number of datapoints will be steps*steps
    var xaxisMax = 7;
    var xaxisStep = 1;
    var yaxisMax = 10;
    var yaxisStep = yaxisMax / ysteps;
    // This charting system takes x and y to be the physical
    // spatial dimensions, we we have to map these into things that 
    // make sense in our model, since we have vastly different scales...
    // Effectively we need a model transducer....
    // Our basic model is to vary x as wire guage, and y as bobbin diameter.
    // t is a the animation parameter
    var tMax = 50;
    var internal_resistance = parseFloat($("#internalresistance").val());
    var bobbin_inner_diameter = parseFloat($("#bobbininnerdiameter").val());
    var bobbin_length = parseFloat($("#bobbinlength").val());
    var voltage = parseFloat($("#voltage").val());
    var magnetdiameter = parseFloat($("#magnetdiameter").val());
    for (var t = 0; t < tMax; t++) {
        for (var x = 0; x <= xaxisMax; x += xaxisStep) {
            for (var y = 1; y <= yaxisMax; y += yaxisStep) {
                // Now set up the model object....
                var awg = AWG_indexes[x]; // AWG
                var model = new CoilModel;
                model.Voltage = voltage;
                model.InternalResistance = internal_resistance;
                model.MagnetDiameter = magnetdiameter;
        	 model.BobbinInnerDiameter = bobbin_inner_diameter;
                model.BobbinOuterDiameter = model.BobbinInnerDiameter + y *
                    1.0;
                model.AWG = awg;
                var computed = computeFromModel(model);
		models.push({
                    x: x,
                    y: y,
                    z: computed.MMF_amp_turns,
                    filter: t,
                    model: computed
                });
		for(var i = 0; i < all_graph_configs.length; i++) {
                    visit_computed(all_graph_configs[i].value,computed,all_graph_configs[i].data,models,x,y,t);
                }
            }
        }
    }
}


// These could be improved by storing the animation state as well, if that is available to us.
function drawVisualization(config) {
    var camera = config.graph ? config.graph.getCameraPosition() : null;
    var container = document.getElementById(config.id);
    config.graph = new vis.Graph3d(container, config.data,
        config.options);
    if (camera) config.graph.setCameraPosition(camera); // restore camera position
}

function drawVisualizations() {
    constructModel();
    all_graph_configs.forEach(drawVisualization);
} 
</script>

    <style>
    </style>
  </head>

<body onload="drawVisualizations()">
    <div class="container">
        <div class="page-header">
            <h1>Coil Choice: Design electromagnetic coils</h1>

            <p class="lead">Brought to you by <a href="https://github.com/PIFAH/PIFAH">Public Invention For All Humanity (PIFAH)</a>.</p>
        </div>

        <div class="row">
            <div class="col-md-4">
                <span id="controls">
                <table>
                    <tr>
                        <td>Voltage (V)</td>
                        <td><input id="voltage" type="text" value="12"></td>
                    </tr>
                    <tr>
                        <td>Internal Resistance (Ohms)</td>
                        <td><input id="internalresistance" type="text" value=
                        "0.025"></td>
                    </tr>
                    <tr>
                        <td>Magnet Diameter (mm)</td>
                        <td><input id="magnetdiameter" type="text" value=
                        "6.35"></td>
                    </tr>
                    <tr>
                        <td>BobbinInnerDiameter (mm)</td>
                        <td><input id="bobbininnerdiameter" type="text" value=
                        "12"></td>
                    </tr>
                    <tr>
                        <td>BobbinLength (mm)</td>
                        <td><input id="bobbinlength" type="text" value=
                        "12"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><input onclick="drawVisualizations();" type=
                        "button" value="Apply parameters"></td>
                    </tr>
                </table>
                </span>
            </div>
            <div class="col-md-4">
                <img src="CoilCircuitDiagram.svg" alt="Coil Circuit Diagram" height="400" width="400">	      
            </div>
            <div class="col-md-4">
                <img src="BobbinDiagram.svg" alt="Bobbin Diagram" height="400" width="400">	      
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
	    </div>
            <div class="col-md-8">
                <span id="mmfchart"></span>
	    </div>
            <div class="col-md-2">
	    </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span id=
                "coilheatlimitchart"></span>
            </div>

            <div class="col-md-6">
                <span id=
                "amperagelimitchart"></span>
            </div>
        </div>
        <div class="row">
        <div class="col-md-12">
<h2>How To Use This Page</h2>

<h3>Motivation</h3>

<h3>Power Supplies</h3>

<h3>Amperage Limitation</h3>

<h3>Heat Limiations</h3>

<h3>Experiments</h3>

<p>
Increase the interanl resistance and observe that the eventually the optimum force is 
generated with thinner wire.

<p>
Change the bobbin dimensions and observe that optimum wire gauge may change.

<p>
Use the animation limits to set the amperage limit imposed by other parts of your circuit.


    <div id="modelinfo">
        <h2>A Basic Physical and Electrical Model</h2>

        <p>Laws and assumptions</p>

        <p>Ohm's laws V = IR</p>

        <p>MMF F = NI</p>

        <p>I assume wire packs as if it were efficiently packed in a squares
        containing the outer diamter of the wire. I assume the effective force
        seen by a magnet of diameter is its percentage of the total area of the
        coil.</p>

        <p>Windings W = Bobbin Length / Wire Diameter</p>

        <p>Turns/ Winding T = (OD - ID) / Wire Diameter</p>

        <p>Average Area of a turn AA = (((OD - ID)/ 2) / 2)^2 * PI</p>

        <p>Example data: CNC Tech 32 gauge manet wire
        http://media.digikey.com/pdf/Data%20Sheets/CNC%20Tech%20PDFs/MW35C_Spec.pdf
        32 0.0005434 0.0249</p>

        <p>Useful approximate battery resistances
        http://www.learningaboutelectronics.com/Articles/Battery-internal-resistance</p>
    </div>

    <div id="thanks">
        <h2>Thanks</h2>

        <p>Thanks to Almende, B. V., for their open-source graphing software,
        <a href="http://visjs.org/">Vis.js</a>.</p>

        <p>Here is an informative reference with a table of typical internal
        restistances: <a href=
        "http://www.learningaboutelectronics.com/Articles/Battery-internal-resistance">
        http://www.learningaboutelectronics.com/Articles/Battery-internal-resistance</a></p>

	<p>The circuit diagram started out as a Fritzing diagram, which I then modified in Inkscape.</p>
	<p>The bobbin diagram was made with Inkscape.</p>
    </div>

<h2>Licensing, Contributing and Reusing</h2>

CoilChoice is Free-libre Open Source Software, licensed under the GPL. 
The <a href="https://github.com/PIFAH/CoilChoice">github repo</a> is a convenient way to reuse it.
To report a bug or make a suggestion, open an <a href="https://github.com/PIFAH/CoilChoice/issues">issue</a> at the github repo.  Even better, create a pull request!

You may prefer to use the <a href="https://github.com/PIFAH/CoilChoice/blob/gh-pages/Magnet%20Coil%20Analysis.ods">spreadsheet</a>, also present in Microsoft Excel format.

        </div>
    </div>
</div>

</body>
</html>
